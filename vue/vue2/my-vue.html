<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Vue</title>
</head>
<body>
    <div id="app">
    </div>
    <script type="text/javascript">
        function observe(obj){
            Object.keys(obj).forEach(key => {
                defineReactive(obj, key, obj[key])
            })
        }

        function defineReactive(obj, key, value){
            Object.defineProperty(obj, key, {
                get(){
                    console.log(`get value ${value}`)
                    return value
                },
                set(newValue){
                    console.log(`set value to ${newValue}`)
                    value = newValue
                    app.update()
                }
            })
        }

        function Vue(options){
            this.$options = options
            this.$data = options.data()
            observe(this.$data)
        }

        Vue.prototype.$mount = function(selector){
            // generate DOM

            // Update
            this.update = function(){
                const child = this.$options.render.call(this)
                const parent = document.querySelector(selector)
                if(!this.isMounted){
                    parent.appendChild(child)
                    this.isMounted = true
                    this.$options.mounted.call(this)
                }else{
                    parent.innerHTML = ""
                    parent.appendChild(child)
                }
            }
            this.update()
        }
    </script>
    <script type="text/javascript">
        const app = new Vue({
            data(){
                return {
                    title: "This is a title"
                }
            },
            mounted(){
                setTimeout(()=>{
                    this.$data.title = "New title"
                }, 1000)
            },
            render(){
                const h1 = document.createElement("h1")
                h1.textContent = this.$data.title
                return h1
            }
        })
        app.$mount("#app")
        console.log(app.$data.title)
    </script>
</body>
</html>